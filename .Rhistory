deaths %>%
filter(Country_Region == "US" & Province_State == "Florida") %>%
rename(County = Admin2) %>%
select(County, X1.22.20:ncol(deaths)) %>%
filter(!County %in% c(
"Out of FL",
"Unassigned"
))
#Pivot data
deaths <- pivot_longer(deaths, cols = X1.22.20:ncol(deaths), names_to = "Date", values_to = "death_count")
#Remove X from date column
deaths$Date <- gsub("X", "", deaths$Date)
#Change data type to Date of Date column
deaths$Date <- as.Date(deaths$Date, format = "%m.%d.%y")
# Cleaning Population Data ------------------------------------------------
pop_data_clean <-
pop_data_raw %>%
mutate(County = gsub(" County", "", County)) %>%
clean_names()
# Cleaning Mobility Data --------------------------------------------------
#Select sub region florida only
mobility_data_clean <-
mobility_data_raw %>%
filter(sub.region == "Florida") %>%
clean_names()
#Select only Florida counties
mobility_data_clean <-
mobility_data_clean %>%
filter(geo_type == "county") %>%
clean_names()
#Remove County string from county, select correct columns
mobility_data_clean <-
mobility_data_clean %>%
mutate(region = gsub(" County", "", region)) %>%
select(region, x2020_01_13:ncol(mobility_data_clean)) %>%
clean_names()
# Pivot table to match formats
mobility_data_clean <-
pivot_longer(mobility_data_clean,
cols = x2020_01_13:ncol(mobility_data_clean),
names_to = "Date",
values_to ="Mobility"
)
# Remove X character from date string
mobility_data_clean <-
mobility_data_clean %>%
mutate(Date = gsub("x", "", Date)) %>%
clean_names()
#Change date column from char to date
mobility_data_clean <-
mobility_data_clean %>%
mutate(date = as.Date(date, format = "%Y_%m_%d"))
# Joining Election Data with COVID Data -----------------------------------
election_data <-
election_data %>%
rename(County = "ï..Vote.by.county")
main_data_cases <-
cases %>%
left_join(election_data, by = "County") %>%
clean_names()
main_data_deaths <-
deaths %>%
left_join(election_data, by = "County") %>%
clean_names()
# Joining Mobility Data ---------------------------------------------------
mobility_data_clean <-
mobility_data_clean %>%
rename(county = region) %>%
clean_names()
main_data_cases <-
main_data_cases %>%
left_join(mobility_data_clean, by = c("county", "date")) %>%
clean_names()
main_data_deaths <-
main_data_deaths %>%
left_join(mobility_data_clean, by = c("county", "date")) %>%
clean_names()
# Normalizing Counts by Pop -----------------------------------------------
norm_case_data <-
main_data_cases %>%
inner_join(pop_data_clean, by = "county") %>%
mutate(population = as.integer(gsub(",","", population))) %>% #Removes `,` and makes int
mutate(normalized_cases = case_count/population) %>%
clean_names()
death_norm_data <-
main_data_deaths %>%
inner_join(pop_data_clean, by = "county")%>%
mutate(population = as.integer((gsub(",", "", population)))) %>%
mutate(deaths_normalized = death_count/population) %>%
clean_names()
# Graphing Data -----------------------------------------------------------
# graphing data from picture of histogram and bar chart look at ggpubr::ggscatterhist()
# Cases
graph_data_cases <-
main_data_cases %>%
mutate(party = as.factor(party)) %>%
filter(case_count > 0)
#Filter for cases above 0 to help focus on important data
norm_case_data <-
norm_case_data %>%
filter(normalized_cases > 0)
#Refactor to correct colors
norm_case_data$party <- factor(
norm_case_data$party, levels = c("republican", "democrat")
)
# Graph scatter plot
norm_case_data %>%
ggplot(aes(x=date, y = normalized_cases, group = county, color=party)) +
geom_line() +
geom_point()
# Deaths final clean up and graph -----------------------------------------
#deaths normalized graph
death_norm_data <-
death_norm_data %>%
mutate(party = as.factor(party)) %>%
filter(death_count >0)
#Re factor Party
death_norm_data$party <- factor(
death_norm_data$party, levels = c("republican", "democrat")
)
death_norm_data %>%
ggplot(aes(x=date, y = deaths_normalized, group = county, color = party)) +
geom_line() +
geom_point()
?lm
View(main_data_cases)
View(norm_case_data)
ggplot(norm_case_data, aes(x=date)) +
geom_scatter(aes(y=mobility)) +
geom_scatter(aes(y = normalized_cases))
ggplot(norm_case_data, aes(x=date)) +
geom_point(aes(y=mobility)) +
geom_point(aes(y = normalized_cases))
ggplot(norm_case_data, aes(x=date)) +
geom_point(aes(y=mobility, color = "mobility")) +
geom_point(aes(y = normalized_cases, color = "normalized_cases"))
?lm
# Import libraries --------------------------------------------------------
library(stats)
library(janitor)
library(dplyr)
library(tidyverse)
library(lubridate)
# Reading Data ------------------------------------------------------------
# Florida election results
election_data <-
read.csv(here::here("florida_county_election_results_2016.csv"))
pop_data_raw <-
read.csv(here::here("population_county_data.csv"))
# %>%
# rename(Rank = "ï..Rank")
mobility_data_raw <-
read.csv(here::here("applemobilitytrends-2020-07-01.csv"))
# WHO COVID Date
covid_cases_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"
covid_deaths_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"
# Read Data to CSV
deaths <- read.csv(url(covid_deaths_url), stringsAsFactors = FALSE)
cases <- read.csv(url(covid_cases_url), stringsAsFactors = FALSE)
# Cleaning Cases Data -----------------------------------------------------
cases <-
cases %>%
filter(Country_Region == "US" & Province_State == "Florida") %>%
rename(County = Admin2) %>%
select(County, X1.22.20:ncol(cases)) %>%
filter(!County %in% c(
"Out of FL",
"Unassigned"
))
cases <- pivot_longer(cases, cols = X1.22.20:ncol(cases), names_to = "Date", values_to = "case_count")
# Remove X from date column
cases$Date <- gsub("X", "", cases$Date)
# set Date column to Date
cases$Date <- as.Date(cases$Date, format = "%m.%d.%y")
# Cleaning Deaths Data ----------------------------------------------------
deaths <-
deaths %>%
filter(Country_Region == "US" & Province_State == "Florida") %>%
rename(County = Admin2) %>%
select(County, X1.22.20:ncol(deaths)) %>%
filter(!County %in% c(
"Out of FL",
"Unassigned"
))
# Pivot data
deaths <- pivot_longer(deaths, cols = X1.22.20:ncol(deaths), names_to = "Date", values_to = "death_count")
# Remove X from date column
deaths$Date <- gsub("X", "", deaths$Date)
# Change data type to Date of Date column
deaths$Date <- as.Date(deaths$Date, format = "%m.%d.%y")
# Cleaning Population Data ------------------------------------------------
pop_data_clean <-
pop_data_raw %>%
mutate(County = gsub(" County", "", County)) %>%
clean_names()
# Cleaning Mobility Data --------------------------------------------------
# Select sub region florida only
mobility_data_clean <-
mobility_data_raw %>%
filter(sub.region == "Florida") %>%
clean_names()
# Select only Florida counties
mobility_data_clean <-
mobility_data_clean %>%
filter(geo_type == "county") %>%
clean_names()
# Remove County string from county, select correct columns
mobility_data_clean <-
mobility_data_clean %>%
mutate(region = gsub(" County", "", region)) %>%
select(region, x2020_01_13:ncol(mobility_data_clean)) %>%
clean_names()
# Pivot table to match formats
mobility_data_clean <-
pivot_longer(mobility_data_clean,
cols = x2020_01_13:ncol(mobility_data_clean),
names_to = "Date",
values_to = "Mobility"
)
# Remove X character from date string
mobility_data_clean <-
mobility_data_clean %>%
mutate(Date = gsub("x", "", Date)) %>%
clean_names()
# Change date column from char to date
mobility_data_clean <-
mobility_data_clean %>%
mutate(date = as.Date(date, format = "%Y_%m_%d"))
# Joining Election Data with COVID Data -----------------------------------
str(election_data)
election_data <-
election_data %>%
rename(County = "ï..Vote.by.county")
main_data_cases <-
cases %>%
left_join(election_data, by = "County") %>%
clean_names()
main_data_deaths <-
deaths %>%
left_join(election_data, by = "County") %>%
clean_names()
# Joining Mobility Data ---------------------------------------------------
mobility_data_clean <-
mobility_data_clean %>%
rename(county = region) %>%
clean_names()
main_data_cases <-
main_data_cases %>%
left_join(mobility_data_clean, by = c("county", "date")) %>%
clean_names()
main_data_deaths <-
main_data_deaths %>%
left_join(mobility_data_clean, by = c("county", "date")) %>%
clean_names()
# Normalizing Counts by Pop -----------------------------------------------
norm_case_data <-
main_data_cases %>%
inner_join(pop_data_clean, by = "county") %>%
mutate(population = as.integer(gsub(",", "", population))) %>% # Removes `,` and makes int
mutate(normalized_cases = case_count / population) %>%
clean_names()
death_norm_data <-
main_data_deaths %>%
inner_join(pop_data_clean, by = "county") %>%
mutate(population = as.integer((gsub(",", "", population)))) %>%
mutate(deaths_normalized = death_count / population) %>%
clean_names()
ibrary(ggplot2)
source(here::here("cleaning_data.R"))
# Graphing Data -----------------------------------------------------------
# graphing data from picture of histogram and bar chart look at ggpubr::ggscatterhist()
# Cases
graph_data_cases <-
main_data_cases %>%
mutate(party = as.factor(party)) %>%
filter(case_count > 0)
# Filter for cases above 0 to help focus on important data
norm_case_data <-
norm_case_data %>%
filter(normalized_cases > 0)
# Refactor to correct colors
norm_case_data$party <- factor(
norm_case_data$party,
levels = c("republican", "democrat")
)
# Graph scatter plot
norm_case_data %>%
ggplot(aes(x = date, y = normalized_cases, group = county, color = party)) +
geom_line() +
geom_point() +
labs(
title = "Normalized cases over time",
subtitle = "Cases/Population of County = Normalized",
x = "Date",
y = "Normalized Cases"
)+
facet_wrap(~party)
# Deaths final clean up and graph -----------------------------------------
# deaths normalized graph
death_norm_data <-
death_norm_data %>%
mutate(party = as.factor(party)) %>%
filter(death_count > 0)
# Re factor Party
death_norm_data$party <- factor(
death_norm_data$party,
levels = c("republican", "democrat")
)
death_norm_data %>%
ggplot(aes(x = date, y = deaths_normalized, group = county, color = party)) +
geom_line() +
geom_point() +
facet_wrap(~party)
# Notes -------------------------------------------------------------------
# Numbers from cases are just low numbers; mobility isn't standardized.
ggplot(norm_case_data, aes(x = date)) +
geom_point(aes(y = mobility, color = "mobility")) +
geom_point(aes(y = normalized_cases, color = "normalized_cases"))
# Filters for democrat
dem_norm_case_data <-
norm_case_data %>%
filter(party == "democrat")
# Filters for Hillsborough & gets rid of NA's in mobility
hills_case_data <-
dem_norm_case_data %>%
filter(county == "Hillsborough") %>%
filter(!is.na(mobility))
# How to fit a loess regression to a plot
hills_case_data %>%
ggplot(aes(x = date, y = normalized_cases)) +
geom_line() +
geom_smooth(method = "loess", se = FALSE)
# The relationship between mobility and cases in Hillsborough
library(patchwork)
p1 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess")
p2 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
coord_flip()
p3 <- p1 + p2
p3
library(ggplot2)
source(here::here("cleaning_data.R"))
# Graphing Data -----------------------------------------------------------
# graphing data from picture of histogram and bar chart look at ggpubr::ggscatterhist()
# Cases
graph_data_cases <-
main_data_cases %>%
mutate(party = as.factor(party)) %>%
filter(case_count > 0)
# Filter for cases above 0 to help focus on important data
norm_case_data <-
norm_case_data %>%
filter(normalized_cases > 0)
# Refactor to correct colors
norm_case_data$party <- factor(
norm_case_data$party,
levels = c("republican", "democrat")
)
# Graph scatter plot
norm_case_data %>%
ggplot(aes(x = date, y = normalized_cases, group = county, color = party)) +
geom_line() +
geom_point() +
labs(
title = "Normalized cases over time",
subtitle = "Cases/Population of County = Normalized",
x = "Date",
y = "Normalized Cases"
)+
facet_wrap(~party)
# Deaths final clean up and graph -----------------------------------------
# deaths normalized graph
death_norm_data <-
death_norm_data %>%
mutate(party = as.factor(party)) %>%
filter(death_count > 0)
# Re factor Party
death_norm_data$party <- factor(
death_norm_data$party,
levels = c("republican", "democrat")
)
death_norm_data %>%
ggplot(aes(x = date, y = deaths_normalized, group = county, color = party)) +
geom_line() +
geom_point() +
facet_wrap(~party)
# Notes -------------------------------------------------------------------
# Numbers from cases are just low numbers; mobility isn't standardized.
ggplot(norm_case_data, aes(x = date)) +
geom_point(aes(y = mobility, color = "mobility")) +
geom_point(aes(y = normalized_cases, color = "normalized_cases"))
# Filters for democrat
dem_norm_case_data <-
norm_case_data %>%
filter(party == "democrat")
# Filters for Hillsborough & gets rid of NA's in mobility
hills_case_data <-
dem_norm_case_data %>%
filter(county == "Hillsborough") %>%
filter(!is.na(mobility))
# How to fit a loess regression to a plot
hills_case_data %>%
ggplot(aes(x = date, y = normalized_cases)) +
geom_line() +
geom_smooth(method = "loess", se = FALSE)
# The relationship between mobility and cases in Hillsborough
library(patchwork)
p1 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess")
p2 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
coord_flip()
p3 <- p1 + p2
p3
# styler:::style_active_file() for styling code
# add pretty labels (x, y , title, subtitle)
# experiment with different types of graphs (x and y axis)
# get a story together about the jumps
# Keep track of where you get the data
# population data: https://www.florida-demographics.com/counties_by_population
View(norm_case_data)
repub_norm_data <-
norm_case_data %>%
filter(party = "republican")
repub_norm_data <-
norm_case_data %>%
filter(party == "republican")
View(repub_norm_data)
santa_rosa_data <-
repub_norm_data %>%
filter(county == "Santa Rosa") %>%
filter(!is.na(mobility))
r1 <-
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess")
r1 <-
santa_rosa_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess")
r1
r2 <-
santa_rosa_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
coord_flip()
r3 <- r1 + r2
r3
r1 <-
santa_rosa_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
labs(
title = "Santa Rosa county",
subtitle = "Cases and Mobility Loess Regression",
x = "Cases per 100,000",
y = "Mobility"
)
r2 <-
santa_rosa_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
coord_flip()+
labs(
title = "Santa Rosa county",
subtitle = "Cases and Mobility Loess Regression",
x = "Cases per 100,000",
y = "Mobility"
)
r3 <- r1 + r2
r3
p1 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
labs(
title = "Hillsborough county",
subtitle = "Cases and Mobility Loess Regression",
x = "Cases per 100,000",
y = "Mobility"
)
p2 <- hills_case_data %>%
ggplot(aes(x = normalized_cases, y = mobility)) +
geom_point() +
geom_smooth(method = "loess") +
coord_flip()+
labs(
title = "Hillsborough county",
subtitle = "Cases and Mobility Loess Regression",
x = "Cases per 100,000",
y = "Mobility"
)
p3 <- p1 + p2
p3
r3
# Numbers from cases are just low numbers; mobility isn't standardized.
ggplot(norm_case_data, aes(x = date)) +
geom_point(aes(y = mobility, color = "mobility")) +
geom_point(aes(y = normalized_cases, color = "normalized_cases"))
